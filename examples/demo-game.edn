;; Paradox Orchestrator (PxO) - Example Game Configuration
;; Demo: 5-minute escape room experience

{
  ;; Game metadata
  :game-name "Demo Escape Room"
  :game-description "A quick 5-minute demo showcasing PxO features"
  :version "1.0.0"
  :format "EDN"
  
  ;; === GLOBAL BUILDING BLOCKS ===
  ;; Shared configuration used across all game modes
  :global {
    ;; Global settings
    :settings {
      :default-mode :demo
      :sequence-max-depth 3
      :hint-duration-sec 15
      :game-heartbeat-ms 1000
      :strict-validation true
    }
    
    ;; MQTT broker configuration
    :mqtt {
      :broker "mqtt://127.0.0.1"
      :port 1883
      :client-id "pxo-demo"
      :keepalive 60
    }
    
    ;; Zone definitions (device control)
    :zones {
      :lights {
        :type "pfx-lights"
        :baseTopic "paradox/demo/lights"
      }
      :mirror {
        :type "pfx-media"
        :baseTopic "paradox/demo/mirror"
      }
      :audio {
        :type "pfx-media"
        :baseTopic "paradox/demo/audio"
      }
      :clock {
        :type "houdini-clock"
        :baseTopic "paradox/demo/clock"
      }
    }
    
    ;; Media file references
    :media {
      :intro-video "media/video/intro.mp4"
      :intro-music "media/audio/intro-music.mp3"
      :ambient-music "media/audio/ambient.mp3"
      :victory-video "media/video/victory.mp4"
      :victory-music "media/audio/victory-music.mp3"
      :failure-video "media/video/failure.mp4"
      :hint-01-audio "media/audio/hints/hint-01.mp3"
      :hint-02-audio "media/audio/hints/hint-02.mp3"
    }
    
    ;; Reusable commands (atomic actions)
    :commands {
      :play-intro-video {
        :zone "mirror"
        :command "playVideo"
        :file :intro-video
      }
      :play-intro-music {
        :zone "audio"
        :command "playAudioFX"
        :file :intro-music
        :volume 60
      }
      :stop-all-media {
        :zones ["mirror" "audio"]
        :command "stopAudio"
      }
      :show-clock {
        :zone "mirror"
        :command "showBrowser"
      }
    }
    
    ;; Named cues (fire-and-forget shortcuts)
    :cues {
      ; Lighting scenes
      :lights-dim {:zone "lights" :command "scene" :scene "dim"}
      :lights-red {:zone "lights" :command "scene" :scene "red"}
      :lights-green {:zone "lights" :command "scene" :scene "green"}
      :lights-blue {:zone "lights" :command "scene" :scene "blue"}
      :lights-rainbow {:zone "lights" :command "scene" :scene "rainbow"}
      
      ; Media commands
      :play-intro-video {:zone "mirror" :command "playVideo" :file "media/video/intro.mp4"}
      :play-intro-music {:zone "audio" :command "playAudioFX" :file "media/audio/intro-music.mp3" :volume 60}
      :stop-all-mirror {:zone "mirror" :command "stopAudio"}
      :stop-all-audio {:zone "audio" :command "stopAudio"}
      :show-clock {:zone "mirror" :command "showBrowser"}
      
      ; Victory/failure
      :victory-lights {:zone "lights" :command "scene" :scene "rainbow"}
      :victory-audio {:zone "audio" :command "playAudioFX" :file "media/audio/victory-music.mp3" :volume 90}
      :victory-video {:zone "mirror" :command "playVideo" :file "media/video/victory.mp4"}
      :failure-lights {:zone "lights" :command "scene" :scene "red"}
      :failure-video {:zone "mirror" :command "playVideo" :file "media/video/failure.mp4"}
    }
    
    ;; Timeline sequences (time-based execution)
    :sequences {
      ; Introduction sequence (30 seconds)
      :welcome {
        :duration 30
        :timeline [
          ; T=0: Dim lights
          {:at 30 :fire :lights-dim}
          
          ; T=3: Start intro video and music
          {:at 27 :fire :play-intro-video}
          {:at 27 :fire :play-intro-music}
          
          ; T=10: Lights transition to red
          {:at 20 :fire :lights-red}
          
          ; T=25: Show countdown clock
          {:at 5 :fire :show-clock}
          
          ; T=27: Lights green (ready to start)
          {:at 3 :fire :lights-green}
        ]
      }
      
      ; Gameplay sequence (300 seconds = 5 minutes)
      :main-game {
        :duration 300
        :timeline [
          ; T=0: Lights green and start ambient music
          {:at 300 :fire :lights-green}
          {:at 270 :zone "audio" :command "playAudioFX" :file "media/audio/ambient.mp3" :loop true :volume 40}
          
          ; T=60 (4 minutes left): First warning
          {:at 240 :fire :lights-blue}
          
          ; T=240 (1 minute left): Final warning
          {:at 60 :fire :lights-red}
          {:at 60 :zone "audio" :command "playAudioFX" :file "media/audio/warning.mp3" :volume 70}
        ]
      }
      
      ; Victory sequence (15 seconds)
      :win {
        :duration 15
        :timeline [
          {:at 15 :fire :stop-all-mirror}
          {:at 15 :fire :stop-all-audio}
          {:at 14 :fire :victory-lights}
          {:at 14 :fire :victory-audio}
          {:at 14 :fire :victory-video}
          {:at 10 :zone "clock" :command "showMessage" :text "YOU WIN!" :color "green"}
        ]
      }
      
      ; Failure sequence (10 seconds)
      :lose {
        :duration 10
        :timeline [
          {:at 10 :fire :stop-all-mirror}
          {:at 10 :fire :stop-all-audio}
          {:at 9 :fire :failure-lights}
          {:at 9 :fire :failure-video}
          {:at 5 :zone "clock" :command "showMessage" :text "TIME'S UP!" :color "red"}
        ]
      }
      
      ; Reset sequence
      :cleanup {
        :duration 3
        :timeline [
          {:at 3 :fire :stop-all-mirror}
          {:at 3 :fire :stop-all-audio}
          {:at 3 :fire :lights-dim}
          {:at 3 :zone "clock" :command "reset"}
        ]
      }
    }
    
    ;; Phase mappings (game state â†’ sequences)
    :phases {
      :intro [:welcome]
      :gameplay [:main-game]
      :solved [:win]
      :failed [:lose]
    }
    
    ;; Hints (multi-type hint system)
    :hints [
      ; Text-only hint
      {
        :id 1
        :name "First Hint"
        :type "text"
        :text "Look for the hidden key under the desk"
      }
      
      ; Speech hint (audio + text)
      {
        :id 2
        :name "Speech Hint"
        :type "speech"
        :text "The code is hidden in the painting"
        :speech-file :hint-01-audio
        :delay 5
        :volume 80
      }
      
      ; Video hint
      {
        :id 3
        :name "Video Clue"
        :type "video"
        :text "Watch the screen carefully"
        :video-file "media/video/hints/hint-03.mp4"
        :video-zone "mirror"
        :delay 10
      }
      
      ; Background audio hint
      {
        :id 4
        :name "Ambient Music Hint"
        :type "audio"
        :audio-file "media/audio/hints/hint-music.mp3"
        :volume 40
        :loop true
      }
    ]
  }
  
  ;; === GAME MODES ===
  ;; Different duration configurations
  :game-modes {
    ; Demo mode (5 minutes)
    :demo {
      :intro-duration 30
      :game-duration 300
      :hint-interval 60
      :description "Quick 5-minute demo"
    }
    
    ; Extended demo (10 minutes)
    :extended {
      :intro-duration 30
      :game-duration 600
      :hint-interval 120
      :description "10-minute extended demo"
      
      ; Override gameplay sequence for longer duration
      :sequences {
        :main-game {
          :duration 600
          :timeline [
            {:at 600 :fire :lights-green}
            {:at 570 :zone "audio" :command "playAudioFX" :file "media/audio/ambient.mp3" :loop true :volume 40}
            {:at 300 :fire :lights-blue}
            {:at 60 :fire :lights-red}
          ]
        }
      }
    }
  }
}
